

# Information to generate a crude ishell wavelength solution for the above method estimate_wavelength_solution
const λsol_pixel_knots = [200, 1024.5, 1848]

const λsol_λ_knots = Dict{Int, Vector{Float64}}(
    212 => [24545.57561435, 24628.37672608, 24705.72472863] ./ 10,
    213 => [24431.48444449, 24513.79686837, 24590.91231465] ./ 10,
    214 => [24318.40830764, 24400.32734124, 24476.99298677] ./ 10,
    215 => [24206.35776048, 24287.85495107, 24364.12010878] ./ 10,
    216 => [24095.33986576, 24176.4424356, 24252.31443701] ./ 10,
    217 => [23985.37381209, 24066.07880622, 24141.55527091] ./ 10,
    218 => [23876.43046386, 23956.7243081, 24031.82506843] ./ 10,
    219 => [23768.48974584, 23848.39610577, 23923.12291214] ./ 10,
    220 => [23661.54443537, 23741.05658955, 23815.40789995] ./ 10,
    221 => [23555.56359209, 23634.68688897, 23708.70106907] ./ 10,
    222 => [23450.55136357, 23529.29771645, 23602.95596074] ./ 10,
    223 => [23346.4923953, 23424.86836784, 23498.18607941] ./ 10,
    224 => [23243.38904298, 23321.379387, 23394.35163611] ./ 10,
    225 => [23141.19183839, 23218.80573474, 23291.44815827] ./ 10,
    226 => [23039.90272625, 23117.1876433, 23189.49231662] ./ 10,
    227 => [22939.50127095, 23016.4487031, 23088.42080084] ./ 10,
    228 => [22840.00907242, 22916.61245655, 22988.26540094] ./ 10,
    229 => [22741.40344225, 22817.65768889, 22888.97654584] ./ 10,
    230 => [22643.6481698, 22719.56466802, 22790.57559244] ./ 10,
    231 => [22546.74892171, 22622.34315996, 22693.02942496] ./ 10,
    232 => [22450.70934177, 22525.96723597, 22596.33915038] ./ 10,
    233 => [22355.49187891, 22430.41612825, 22500.49456757] ./ 10,
    234 => [22261.08953053, 22335.71472399, 22405.49547495] ./ 10,
    235 => [22167.42305394, 22241.83394135, 22311.25574559] ./ 10,
    236 => [22074.72848136, 22148.73680381, 22217.91297633] ./ 10,
    237 => [21982.75611957, 22056.42903627, 22125.33774808] ./ 10,
    238 => [21891.49178289, 21964.91093944, 22033.50356525] ./ 10,
    239 => [21801.07332421, 21874.20764171, 21942.41058186] ./ 10,
    240 => [21711.43496504, 21784.20091295, 21852.24253555] ./ 10
)

function get_λsol_estimate(filename::String; order::Int)
    jd = get_exposure_start_time(iSHELLL1(filename))
    pfit = Polynomials.fit(λsol_pixel_knots, λsol_λ_knots[order], length(λsol_pixel_knots) - 1)
    λ = pfit.(1:2048)
    if 2459561.0 < jd < 2459846.0
       λ .+= -0.22
    end
    return λ
end